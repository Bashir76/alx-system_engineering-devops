#!/usr/bin/env bash
# This script configures Nginx to perform a 301 Moved Permanently redirect from /redirect_me to a specified URL.

# Ensure Nginx is installed
if ! dpkg -l | grep -q "nginx"; then
    sudo apt-get update -y
    sudo apt-get install nginx -y
fi

# Define the source and destination locations for the redirect
source_location="/etc/nginx/sites-available/default"
destination_location="/etc/nginx/sites-available/redirect_me"

# Create a new Nginx configuration file for the redirect
echo "server {
    listen 80;
    listen [::]:80;

    server_name _;

    location /redirect_me {
        return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;
    }

    # ... any other server configuration ...

}" | sudo tee $destination_location > /dev/null

# Create a symbolic link to enable the new site configuration
sudo ln -s $destination_location /etc/nginx/sites-enabled/

# Remove the default symbolic link, if it exists
if [ -L /etc/nginx/sites-enabled/default ]; then
    sudo rm /etc/nginx/sites-enabled/default
fi

# Reload Nginx to apply the changes
sudo service nginx reload

echo "Nginx has been configured to perform a 301 Moved Permanently redirect from /redirect_me to https://www.youtube.com/watch?v=QH2-TGUlwu4."
